<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Welcome to Willow</title>

        <script src="/uv/uv.bundle.js"></script>
        <script src="/uv/uv.config.js"></script>
        <script src="/baremux/index.js"></script>

        <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", async () => {
                await navigator.serviceWorker.register("/uv/sw.js");
            });
        }
        </script>

        <link rel="stylesheet" href="example.css">
        <!-- nicer display font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    </head>
    <body>
        <!-- Top center show-search button (hidden by default) -->
        <button id="showSearch" class="show-search" aria-hidden="true">Search</button>

        <!-- Page header: centered title sitting slightly above the card -->
        <header class="page-header">
            <h1 class="title">Welcome to Willow</h1>
            <div class="header-controls">
                <div class="transport-wrap">
                    <select id="switcher" aria-label="Connection mode">
                        <option value="">--Choose a transport (optional)--</option>
                        <option value="epoxy">Epoxy</option>
                        <option value="bare">Bare</option>
                    </select>
                </div>
                <button id="infoBtn" class="info-btn" aria-label="About Willow">i</button>
            </div>
        </header>

        <main class="hero">
            <div class="card" id="searchCard">

                <div class="search-row">
                    <input type="text" id="urlInput" placeholder="Enter URL or search terms" autocomplete="off" />
                    <button id="searchButton" aria-label="Search">Search</button>
                </div>

                <div class="rotator-wrap" aria-hidden="true">
                    <div id="rotator" class="rotator">took 1 month to make</div>
                </div>

                <div class="options-row">
                    <!-- moved transport select to header -->
                </div>
            </div>
        </main>

        <iframe id="iframeWindow" class="iframeWindow" title="Willow preview"></iframe>

        <script src="example.js"></script>

        <script>
        // UI-only script: hide the search card after search and show a small button to restore it
        (function(){
            const card = document.getElementById('searchCard');
            const showBtn = document.getElementById('showSearch');
            const input = document.getElementById('urlInput');
            const submit = document.getElementById('searchButton');

            function hideCard(){
                if(!card) return;
                card.classList.add('hidden-card');
                showBtn.setAttribute('aria-hidden','false');
                showBtn.classList.add('visible');
            }

            function showCard(){
                if(!card) return;
                // Clear iframe to stop any embedded site activity before showing the UI
                const iframe = document.getElementById('iframeWindow');
                if(iframe){
                    try{ iframe.src = 'about:blank'; } catch(e){}
                }

                // Clear iframe and force a top-level navigation to the site root so we end up
                // back on the index page (prevents the search UI from being shown inside an embedded page)
                try{ iframe.src = 'about:blank'; } catch(e){}
                // Use location.replace so we don't create an extra history entry
                if(location.pathname !== '/' && location.pathname !== '/index.html'){
                    location.replace('/');
                    return;
                }

                // If already on the root, just show the card
                card.classList.remove('hidden-card');
                showBtn.setAttribute('aria-hidden','true');
                showBtn.classList.remove('visible');
                input.focus();
            }

            // Hide the card after the existing onclick runs. We wrap submit click to allow original logic first.
            if(submit){
                submit.addEventListener('click', (e)=>{
                    // Allow the event loop to process the original handlers first
                    setTimeout(()=>{
                        hideCard();
                    }, 50);
                });
            }

            // Also hide when enter is pressed (example.js triggers click on Enter)
            input && input.addEventListener('keydown', (ev)=>{
                if(ev.key === 'Enter'){
                    setTimeout(()=> hideCard(), 50);
                }
            });

            showBtn.addEventListener('click', ()=> showCard());
        })();
        </script>
    </body>
</html>
